<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    html,body,#map{height:100%;margin:0}
    .route { stroke: #1e7bff; stroke-width: 5; }
  </style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map',{ zoomControl:false }).setView([35.8895,128.611],16);
  L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom: 19 }).addTo(map);
  L.control.zoom({ position: 'topleft' }).addTo(map);

  // Layers
  const routeLayer  = L.polyline([], { color:'#1e7bff', weight:5 }).addTo(map);
  const myLayer     = L.layerGroup().addTo(map);
  const hazardLayer = L.layerGroup().addTo(map);

  // My location marker
  let myMarker = null;
  function setMyLocation(lat,lng,center){
    if (myMarker) { myLayer.removeLayer(myMarker); myMarker=null; }
    myMarker = L.marker([lat,lng], {
      icon: L.icon({
        iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
        iconSize:[25,41], iconAnchor:[12,41]
      })
    }).addTo(myLayer);
    if(center) map.setView([lat,lng], Math.max(map.getZoom(), 17));
  }
  function clearMyLocation(){
    if (myMarker){ myLayer.removeLayer(myMarker); myMarker=null; }
  }

  // Route
  function drawRoute(latlngs){
    routeLayer.setLatLngs((latlngs||[]).map(p=>[p.lat,p.lng]));
    if (latlngs && latlngs.length) {
      const b = routeLayer.getBounds(); map.fitBounds(b.pad(0.15));
    }
  }

  // Hazards (red translucent circles)
  function setHazards(items){
    hazardLayer.clearLayers();
    (items||[]).forEach(h=>{
      const r = typeof h.radius==='number' ? h.radius : 20;
      L.circle([h.lat,h.lng], {
        radius: r,
        color:'#ff3b30',
        weight:2,
        fillColor:'#ff3b30',
        fillOpacity:0.25
      }).addTo(hazardLayer);
    });
  }

  // Click â†’ RN
  function post(msg){ (window.ReactNativeWebView||window).postMessage(JSON.stringify(msg)); }
  map.on('click', (e)=> post({ type:'click', lat:e.latlng.lat, lng:e.latlng.lng }));

  // Expose
  window.setMyLocation = setMyLocation;
  window.clearMyLocation = clearMyLocation;
  window.drawRoute = drawRoute;
  window.setHazards = setHazards;
</script>
</body>
</html>
